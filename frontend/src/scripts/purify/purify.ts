import { safeHtmlAttributes } from './attrs'
import { IS_ALLOWED_URI } from './regexp'

export const purify = (htmlContent: HTMLTemplateElement['content']) => {
  const tags = htmlContent.querySelectorAll('*')
  for (const tag of tags) {
    const attributes = tag.attributes
    for (const { name: attributeName, value: attributeValue } of attributes) {
      if (!safeHtmlAttributes.includes(attributeName)) tag.removeAttribute(attributeName) // delete forbidden tags
      if (
        (attributeName === 'src' || attributeName == 'href') &&
        !attributeValue.match(IS_ALLOWED_URI)
      ) {
        tag.removeAttribute(attributeName) // delete links with javasciprt:... or data:text/html, <script>...</script>
      }
    }
  }
}
