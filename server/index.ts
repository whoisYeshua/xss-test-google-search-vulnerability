import Fastify, { FastifyServerOptions } from 'fastify'
import fastifyStatic, { FastifyStaticOptions } from '@fastify/static'

import path from './path.js'
import cookieRotes from './routes/cookie/cookie.route.js'

const fastifyOptions: FastifyServerOptions = {
  logger: {
    transport: {
      target: 'pino-pretty',
      options: { destination: 1 },
    },
  },
}
const staticOptions: FastifyStaticOptions = {
  root: path.publicPath,
}

const server = Fastify(fastifyOptions)

server.register(fastifyStatic, staticOptions)

server.get('/', async (request, reply) => {
  return reply.sendFile('index.html')
})

const start = async () => {
  server.register(cookieRotes)

  try {
    await server.listen({ port: 3000 })
  } catch (err) {
    server.log.error(err)
    process.exit(1)
  }
}
start()
